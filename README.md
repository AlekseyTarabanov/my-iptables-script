# üõ°Ô∏è –°–∫—Ä–∏–ø—Ç –∑–∞—â–∏—Ç—ã —Å–µ—Ä–≤–µ—Ä–∞ —Å iptables

## üìå –í–≤–µ–¥–µ–Ω–∏–µ

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç ‚Äî —ç—Ç–æ **–ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä –ø—Ä–∞–≤–∏–ª iptables**, –∫–æ—Ç–æ—Ä—ã–π:
- –û—Å—Ç–∞–≤–ª—è–µ—Ç –æ—Ç–∫—Ä—ã—Ç—ã–º–∏ —Ç–æ–ª—å–∫–æ **–Ω—É–∂–Ω—ã–µ –ø–æ—Ä—Ç—ã**.
- –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏ –ø–∞–∫–µ—Ç–æ–≤ (**–∑–∞—â–∏—Ç–∞ –æ—Ç DDoS**).
- –î–µ–ª–∏—Ç –¥–æ—Å—Ç—É–ø –º–µ–∂–¥—É **WAN (–∏–Ω—Ç–µ—Ä–Ω–µ—Ç)** –∏ **LAN (–ª–æ–∫–∞–ª—å–Ω–∞—è —Å–µ—Ç—å)**.
- –ó–∞—â–∏—â–∞–µ—Ç –æ—Ç –∞—Ç–∞–∫ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–µ—Ç–∏ (SYN Flood, UDP Flood, ICMP Flood).
- –î–∞—ë—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å **–º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å** –∏ **–æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å** –∑–∞—â–∏—Ç—É.

---

## üìä –¢–∞–±–ª–∏—Ü–∞ –ø–æ—Ä—Ç–æ–≤ –∏ –∑–∞—â–∏—Ç

| –ü–æ—Ä—Ç  | –ü—Ä–æ—Ç–æ–∫–æ–ª | –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ | –ß—Ç–æ —Å–¥–µ–ª–∞–ª –≤ –ø—Ä–∞–≤–∏–ª–∞—Ö |
|-------|----------|-------------|----------|------------------------|
| **22** | TCP | WAN+LAN | SSH | –†–∞–∑—Ä–µ—à–∏–ª, –Ω–æ –æ–≥—Ä–∞–Ω–∏—á–∏–ª 30 —Å–æ–µ–¥–∏–Ω./—Å–µ–∫ –∏ 200 SYN pps. –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–±–æ—Ä–∞ –ø–∞—Ä–æ–ª–µ–π –∏ SYN Flood. |
| **80** | TCP | WAN+LAN | HTTP (nginx) | –†–∞–∑—Ä–µ—à–∏–ª, –Ω–æ —Å –ª–∏–º–∏—Ç–æ–º 50 —Å–æ–µ–¥–∏–Ω./—Å–µ–∫ –∏ 500 SYN pps. |
| **443** | TCP | WAN+LAN | HTTPS (nginx) | –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ HTTP, –Ω–æ –ø–æ–¥ HTTPS. |
| **25566‚Äì26000** | TCP/UDP | WAN+LAN | Minecraft | –û—Ç–∫—Ä—ã–ª –≤—Å–µ –∏–≥—Ä–æ–≤—ã–µ –ø–æ—Ä—Ç—ã, –ª–∏–º–∏—Ç 30 —Å–æ–µ–¥–∏–Ω./—Å–µ–∫ –∏ 500 pps. |
| **33186** | UDP | WAN+LAN | VPN | –†–∞–∑—Ä–µ—à–∏–ª, –ª–∏–º–∏—Ç 200 pps, –∑–∞—â–∏—Ç–∞ –æ—Ç UDP Flood. |
| **5900** | TCP | WAN+LAN | VNC | –õ–∏–º–∏—Ç–∏—Ä–æ–≤–∞–ª –¥–æ 10 —Å–æ–µ–¥–∏–Ω./—Å–µ–∫ –∏ 100 pps, —á—Ç–æ–±—ã –Ω–µ –∑–∞–¥–¥–æ—Å–∏–ª–∏. |
| **27231** | TCP | WAN+LAN | Nginx (–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Å–µ—Ä–≤–∏—Å) | –û—Å—Ç–∞–≤–∏–ª –æ—Ç–∫—Ä—ã—Ç—ã–º —Å –ª–∏–º–∏—Ç–æ–º 20 —Å–æ–µ–¥–∏–Ω./—Å–µ–∫ –∏ 200 pps. |
| **8388** | TCP/UDP | **LAN only** | Shadowsocks | WAN-–∑–∞–ø—Ä–µ—Ç, –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –∏–∑ LAN, —á—Ç–æ–±—ã –Ω–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–ª–∏. |
| **53** | TCP/UDP | WAN (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ IP) | DNS | –õ–∏–º–∏—Ç 100 pps, —Ç–æ–ª—å–∫–æ –æ—Ç –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö IP. |
| **123** | UDP | WAN (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ IP) | NTP | –õ–∏–º–∏—Ç 50 pps, —Ç–æ–ª—å–∫–æ –æ—Ç –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö IP. |
| **3000** | TCP | WAN+LAN | Grafana | –õ–∏–º–∏—Ç 10 —Å–æ–µ–¥–∏–Ω./—Å–µ–∫ –∏ 100 pps. |
| **9090** | TCP | LAN only | Prometheus | –¢–æ–ª—å–∫–æ LAN, –±–µ–∑ –ª–∏–º–∏—Ç–æ–≤. |
| **9100** | TCP | LAN only | Node Exporter | –¢–æ–ª—å–∫–æ LAN, –±–µ–∑ –ª–∏–º–∏—Ç–æ–≤. |

---

## üé® –°—Ö–µ–º–∞ –ø–æ—Ç–æ–∫–æ–≤ –∏ –ª–∏–º–∏—Ç–æ–≤

üåç **WAN (–∏–Ω—Ç–µ—Ä–Ω–µ—Ç)**  
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ  
**TCP:** 22, 80, 443, 25566‚Äì30000, 5900, 27231, 3000  
**UDP:** 33186 (VPN)  
**TCP/UDP:** 53, 123 (—Ç–æ–ª—å–∫–æ –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ IP)  
–í—Å–µ ‚Äî —Å –ª–∏–º–∏—Ç–∞–º–∏ –Ω–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∏ pps.  
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ  
‚¨á  
üñ• **–°–µ—Ä–≤–µ—Ä —Å iptables**  
‚¨Ü  
üì° **LAN (–ª–æ–∫–∞–ª—å–Ω–∞—è —Å–µ—Ç—å)**  
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ  
–í—Å–µ –Ω—É–∂–Ω—ã–µ –ø–æ—Ä—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ—á—Ç–∏ –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π,  
–≤–∫–ª—é—á–∞—è 8388 (Shadowsocks), 9090 (Prometheus), 9100 (Node Exporter).  
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ  

---
```mermaid
graph LR
  %% –û—Å–Ω–æ–≤–Ω—ã–µ –∑–æ–Ω—ã
  subgraph WAN [üåê Internet WAN]
    W1[22 TCP SSH]
    W2[80 TCP HTTP]
    W3[443 TCP HTTPS]
    W4[25566‚Äì26000 TCP/UDP Minecraft]
    W5[33186 UDP VPN]
    W6[5900 TCP VNC]
    W7[27231 TCP Nginx]
    W8[53 TCP/UDP DNS trusted IP]
    W9[123 UDP NTP trusted IP]
    W10[3000 TCP Grafana]
  end

  subgraph SERVER [üñ•Ô∏è Server with iptables]
  end

  subgraph LAN [üè† Local Area Network]
    L1[8388 TCP/UDP Shadowsocks]
    L2[9090 TCP Prometheus]
    L3[9100 TCP Node Exporter]
  end

  %% –°–≤—è–∑–∏
  W1 --> SERVER
  W2 --> SERVER
  W3 --> SERVER
  W4 --> SERVER
  W5 --> SERVER
  W6 --> SERVER
  W7 --> SERVER
  W8 --> SERVER
  W9 --> SERVER
  W10 --> SERVER

  SERVER --> L1
  SERVER --> L2
  SERVER --> L3

  %% –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ INFO —Å–ø—Ä–∞–≤–∞
  INFO --- SERVER

  %% –ö–ª–∞—Å—Å—ã –¥–ª—è —Ü–≤–µ—Ç–æ–≤–æ–≥–æ –≤—ã–¥–µ–ª–µ–Ω–∏—è
  classDef tcp fill:#d4f1f9,stroke:#0077b6,stroke-width:2px,color:#003366,font-weight:bold;
  classDef udp fill:#fff3cd,stroke:#ff9800,stroke-width:2px,color:#664400,font-weight:bold;
  classDef mc fill:#e6ffe6,stroke:#4caf50,stroke-width:2px,color:#2e7d32,font-weight:bold;
  classDef dns fill:#f0e6ff,stroke:#673ab7,stroke-width:2px,color:#4a148c,font-weight:bold;
  classDef ntp fill:#ffe6e6,stroke:#f44336,stroke-width:2px,color:#b71c1c,font-weight:bold;
  classDef lan fill:#e0e0e0,stroke:#757575,stroke-width:2px,color:#222222,font-weight:bold;

  %% –ü—Ä–∏–º–µ–Ω—è–µ–º –∫–ª–∞—Å—Å—ã –∫ —É–∑–ª–∞–º WAN
  class W1,W2,W3,W6,W7,W10 tcp;
  class W5 udp;
  class W4 mc;
  class W8 dns;
  class W9 ntp;

  %% LAN
  class L1,L2,L3 lan;
```
---

## üìú –û–ø–∏—Å–∞–Ω–∏–µ, —á—Ç–æ —Å–¥–µ–ª–∞–Ω–æ –Ω–∞ –∫–∞–∂–¥–æ–º –ø–æ—Ä—Ç—É

1. **SSH (22/TCP)** ‚Äî —Ä–∞–∑—Ä–µ—à—ë–Ω —Å WAN –∏ LAN, –Ω–æ –µ—Å—Ç—å –ª–∏–º–∏—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –≤ —Å–µ–∫—É–Ω–¥—É, —á—Ç–æ–±—ã –∑–∞—â–∏—Ç–∏—Ç—å –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞.
2. **HTTP (80/TCP)** –∏ **HTTPS (443/TCP)** ‚Äî –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞, –Ω–æ —Å –ª–∏–º–∏—Ç–∞–º–∏, —á—Ç–æ–±—ã –≤–µ–±-—Å–µ—Ä–≤–µ—Ä –Ω–µ –ø–æ–ª–æ–∂–∏–ª–∏ DDoS-–æ–º.
3. **Minecraft (25566‚Äì26000 TCP/UDP)** ‚Äî –æ—Å—Ç–∞–≤–ª–µ–Ω—ã –∏–≥—Ä–æ–≤—ã–µ –ø–æ—Ä—Ç—ã, –Ω–æ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –Ω–∞ pps –∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.
4. **VPN (33186/UDP)** ‚Äî –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è WAN, –Ω–æ –∑–∞—â–∏—â—ë–Ω –æ—Ç —Ñ–ª—É–¥–∞.
5. **VNC (5900/TCP)** ‚Äî –æ–≥—Ä–∞–Ω–∏—á–µ–Ω, —á—Ç–æ–±—ã —Ä–∞–±–æ—Ç–∞–ª –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –Ω–æ –±—ã–ª –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –º–∞—Å—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∞—Ç–∞–∫–∏.
6. **Nginx –Ω–∞ 27231/TCP** ‚Äî –æ—Ç–∫—Ä—ã—Ç, –Ω–æ —Ç–æ–∂–µ —Å –ª–∏–º–∏—Ç–∞–º–∏.  
7. **Shadowsocks (8388/TCP/UDP)** ‚Äî –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–∫—Ä—ã—Ç —Å WAN, –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –≤ LAN.
8. **DNS (53 TCP/UDP)** –∏ **NTP (123 UDP)** ‚Äî —Ä–∞–∑—Ä–µ—à–µ–Ω—ã —Ç–æ–ª—å–∫–æ –æ—Ç –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö IP.
9. **Grafana (3000/TCP)** ‚Äî –æ—Ç–∫—Ä—ã—Ç –¥–ª—è WAN, –Ω–æ —Å –º–∞–ª–µ–Ω—å–∫–∏–º–∏ –ª–∏–º–∏—Ç–∞–º–∏.
10. **Prometheus (9090/TCP)** –∏ **Node Exporter (9100/TCP)** ‚Äî –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –≤ LAN.

---

## üåê –û–±—â–∞—è –ª–æ–≥–∏–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

```plaintext
üõ¨ –ü–∞–∫–µ—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç
       ‚îÇ
       ‚ñº
1Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—è–µ–º: –ø–æ—Ä—Ç –∏ –ø—Ä–æ—Ç–æ–∫–æ–ª —Ä–∞–∑—Ä–µ—à–µ–Ω—ã?
       ‚îÇ
       ‚îú‚îÄ ‚ùå –ù–µ—Ç ‚Üí DROP (–æ—Ç–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ä–∞–∑—É, –±–µ–∑ –∑–∞–ø–∏—Å–∏ –≤ conntrack)
       ‚îÇ
       ‚îî‚îÄ ‚úÖ –î–∞ ‚Üí –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–∏–º–∏—Ç—ã (pps / —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –≤ —Å–µ–∫)
                   ‚îÇ
                   ‚îú‚îÄ üö´ –õ–∏–º–∏—Ç –ø—Ä–µ–≤—ã—à–µ–Ω ‚Üí DROP
                   ‚îÇ
                   ‚îî‚îÄ ‚úÖ –í—Å—ë –æ–∫ ‚Üí –ü—Ä–æ–ø—É—Å–∫–∞–µ–º
```

